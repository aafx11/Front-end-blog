## 前端监控SDK（功能，错误，性能，用户，白屏，流程，目的）
1. 前端监控SDK一般有三大功能，采集错误信息，采集性能信息，记录用户行为，白屏检测
2. 采集错误信息，一般包括 js 运行错误，语法错误，异步错误，静态资源加载错误，接口请求报错，
   有时候 B端 用户在软件报错之后，反馈给开发，因为用户他本身不是专业的开发人员，有时候开发根据用户的描述是很难复现和定位bug的，尤其是移动端，
   这时候就需要前端监控SDK去收集报错信息，帮助开发人员去快速定位bug
3. 采集性能信息，一般包括 FP 白屏时间（用户从输入url到页面内容展示的时间）, FCP 首次内容绘制的时间，LCP 最大内容绘制时间，
   FID 首次输入延迟（用户触发输入后，到浏览器响应时间）等等，这些性能信息就能给开发人员优化项目作为一个依据
4. 记录用户行为，就包括用户在页面的操作，比如点击了什么按钮，页面的跳转，用户的设备型号等等，有了这些信息就能帮助开发人员更快的去定位bug
5. 还有就是白屏检测，通过document.elementsFromPoint 这个api，通过输入坐标点，返回该坐标点的dom元素数组，如果这个数组里只有html和body元素，
   我们就判断系统出现了白屏
6. 整一个监控的流程就是，埋点，信息采集，信息存储，信息上报，服务端接收到之后，对信息进行一个可视化处理，做成数据看板，比如性能指标汇总，报错列表等等
7. 监控的目的，一个是事前预警，当出现数据异常的时候，及时处理，避免造成大面积的错误，一个是事后分析，分析故障发生的原因，故障发生的位置，防止类似的情况
   再次发生，还有一个就是性能优化，通过采集关键的性能指标，为开发者提供优化参考，最后一个是通过采集页面的 pv和uv 等信息，为决策者的决策提供数据支撑，
   （比如应该优先优化更多用户使用的模块）


## 错误信息采集 （onerror，error，unhandlerrejection，errorHandler，XMLHttpRequest）
1. window的 onerror 可以捕获到常规错误，异步错误（但是不能捕获静态资源加载错误）
2. 监听 window 的 error 事件，可以捕获到静态资源加载失败的错误
3. 监听 unhandlerrejection 事件，可以捕获到 Promise 中抛出的错误
4. 如果是 Vue 项目，就通过Vue.config.errorHandler 来捕获异常
5. 接口请求报错是通过重写 XMLHttpRequest 对象的 open 方法和 send 方法，来获取到接口报错的时候，请求的参数

## 性能信息采集
1. 性能信息采集是通过 window.performance.timing 对象来实现的，这个对象会提供各个阶段耗时的数据，
   我们能够通过这些耗时，计算出我们想要的指标。
2. 比如 FP 白屏时间，就是通过 DomInteractive dom解析结束的时间 减去 fetchStart 浏览器准备好使用http请求获取文档的时间
3. 比如 FCP 首次内容绘制时间，通过 loadEventEnd 页面加载完成时的时间 减去 domInteractive dom解析结束的时间
   
## 用户行为记录
1. 监听用户的点击事件，给 document 添加上点击事件监听，在事件里，检查一下被点击的元素，有没有埋点的属性，有的话进行信息上报
2. 监听用户的页面跳转，路由有 history 和 hash 两种模式，如果是 history 模式，通过监听 popstate（） 事件，监听页面的跳转，
   如果是 hash 模式，通过重写 pushState和 replaceState 事件来监听页面的跳转
3. 通过 navigator 对象获取用户用的是什么操作系统（platform）和什么浏览器（userAgent），通过 screen 对象获取屏幕的分辨率（width，height）

## 信息上报的方法
1. 一种是图片打点上报，支持跨域，体积小，不需要等待服务器返回数据，缺点是 url 长度受到浏览器的限制
2. 通过 requestIdleCallback 这个api，自动在浏览器空闲的时候进行上报
3. （SendBeacon api也能在浏览器空闲的时候上报信息，并且即使浏览器被关闭，也能完成执行）